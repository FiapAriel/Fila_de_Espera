<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"> <!-- Define o conjunto de caracteres como UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Define a viewport para layout responsivo -->
    <link rel="icon" href="Lazzarella_moca.jpg" type="Moça"> <!-- Imagem que aparece na aba do site -->
    <title>Clientes Cadastrados</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Define a fonte usada na página */
            background-color: #f7f9fc; /* Define a cor de fundo da página */
            color: #333; /* Define a cor do texto */
            display: flex; /* Usa flexbox para alinhar itens */
            justify-content: center; /* Centraliza itens horizontalmente */
            align-items: center; /* Centraliza itens verticalmente */
            height: 100vh; /* Define a altura da página como 100% da altura da janela */
            margin: 0; /* Remove margens padrão */
            padding: 10px; /* Adiciona padding para evitar que o conteúdo encoste nas bordas */
        }
        .container {
            background: #fff; /* Define a cor de fundo do contêiner */
            padding: 20px; /* Define o preenchimento interno do contêiner */
            border-radius: 8px; /* Define cantos arredondados para o contêiner */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Adiciona uma sombra ao contêiner */
            width: 100%; /* Define a largura do contêiner como 100% */
            max-width: 800px; /* Define a largura máxima do contêiner */
            text-align: center; /* Centraliza o texto dentro do contêiner */
        }
        h1 {
            font-size: 24px; /* Define o tamanho da fonte do título */
            margin-bottom: 20px; /* Adiciona um espaço abaixo do título */
            color: #4a90e2; /* Define a cor do título */
        }
        .search-container {
            display: flex; /* Usa flexbox para alinhar itens */
            justify-content: center; /* Centraliza horizontalmente */
            margin-bottom: 20px; /* Adiciona um espaço abaixo da barra de pesquisa */
        }
        .search-container input {
            width: 50%; /* Define a largura da barra de pesquisa */
            padding: 10px; /* Define o preenchimento interno da barra de pesquisa */
            border: 1px solid #ddd; /* Define a cor e a largura das bordas da barra de pesquisa */
            border-radius: 4px; /* Define cantos arredondados para a barra de pesquisa */
        }
        button {
            width: calc(100% - 22px); /* Define a largura dos botões */
            padding: 10px; /* Define o preenchimento interno dos botões */
            margin: 5px 0; /* Adiciona um espaço ao redor dos botões */
            border: none; /* Remove as bordas dos botões */
            border-radius: 4px; /* Define cantos arredondados para os botões */
            background-color: #4a90e2; /* Define a cor de fundo dos botões */
            color: white; /* Define a cor do texto dos botões */
            cursor: pointer; /* Altera o cursor para uma mão ao passar sobre os botões */
        }
        button:hover {
            background-color: #357ab7; /* Altera a cor de fundo ao passar o cursor sobre os botões */
        }
        #clientesContainer {
            max-height: 300px; /* Define a altura máxima do contêiner de clientes */
            overflow-y: auto; /* Adiciona barra de rolagem vertical quando necessário */
        }
        table {
            width: 100%; /* Define a largura da tabela */
            border-collapse: collapse; /* Colapsa bordas da tabela */
            margin-top: 10px; /* Adiciona um espaço acima da tabela */
        }
        table, th, td {
            border: 1px solid #ddd; /* Define a cor e a largura das bordas */
        }
        th, td {
            padding: 8px; /* Define o preenchimento interno das células */
            text-align: left; /* Alinha o texto à esquerda */
        }
        th {
            background-color: #f2f2f2; /* Define a cor de fundo das células do cabeçalho */
            cursor: pointer; /* Altera o cursor para uma mão ao passar sobre os cabeçalhos */
        }
        .edit-btn, .delete-btn {
            cursor: pointer; /* Altera o cursor para uma mão ao passar sobre os botões */
            color: white; /* Define a cor do texto dos botões */
            padding: 5px 10px; /* Define o preenchimento interno dos botões */
            border-radius: 4px; /* Define cantos arredondados para os botões */
            border: none; /* Remove as bordas dos botões */
        }
        .edit-btn {
            background-color: #4a90e2; /* Define a cor de fundo dos botões de editar */
        }
        .edit-btn:hover {
            background-color: #357ab7; /* Altera a cor de fundo ao passar o cursor sobre os botões de editar */
        }
        .delete-btn {
            background-color: #e74c3c; /* Define a cor de fundo dos botões de remover */
        }
        .delete-btn:hover {
            background-color: #c0392b; /* Altera a cor de fundo ao passar o cursor sobre os botões de remover */
        }
        .back-btn {
            width: calc(50% - 10px); /* Define a largura dos botões */
            padding: 10px; /* Define o preenchimento interno dos botões */
            margin: 5px 5px; /* Adiciona um espaço ao redor dos botões */
            border: none; /* Remove as bordas dos botões */
            border-radius: 4px; /* Define cantos arredondados para os botões */
            background-color: #4a90e2; /* Define a cor de fundo dos botões */
            color: white; /* Define a cor do texto dos botões */
            cursor: pointer; /* Altera o cursor para uma mão ao passar sobre os botões */
        }
        .back-btn:hover {
            background-color: #357ab7; /* Altera a cor de fundo ao passar o cursor sobre os botões */
        }
        /* Estilos para as mensagens */
        .message-container {
            margin-top: 20px;
        }
        .message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            display: none;
        }
        .success {
            background-color: #2ecc71;
            color: white;
        }
        .error {
            background-color: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Clientes Cadastrados</h1>
        <!-- Contêiner de pesquisa -->
        <div class="search-container">
            <input type="text" id="barraPesquisa" placeholder="Pesquisar por qualquer informação..."> <!-- Barra de pesquisa unificada -->
        </div>
        <div id="clientesContainer">
            <!-- Tabela para exibir clientes cadastrados -->
            <table>
                <thead>
                    <tr>
                        <th onclick="ordenarTabela('id')">ID</th> <!-- Cabeçalho da coluna ID com opção de ordenação -->
                        <th onclick="ordenarTabela('nome')">Nome</th> <!-- Cabeçalho da coluna Nome com opção de ordenação -->
                        <th onclick="ordenarTabela('telefone')">Telefone</th> <!-- Cabeçalho da coluna Telefone com opção de ordenação -->
                        <th onclick="ordenarTabela('cpf')">CPF</th> <!-- Cabeçalho da coluna CPF com opção de ordenação -->
                        <th onclick="ordenarTabela('visitas')">Visitas</th> <!-- Cabeçalho da coluna Visitas com opção de ordenação -->
                        <th id="acoesHeader">Ações</th> <!-- Cabeçalho da coluna Ações -->
                    </tr>
                </thead>
                <tbody id="clientes">
                </tbody>
            </table>
        </div>
        <!-- Botão para voltar para a página inicial -->
        <button onclick="voltar()" class="back-btn">Voltar</button>
        
        <!-- Contêiner para as mensagens -->
        <div class="message-container">
            <div id="message" class="message"></div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search); // Obtém os parâmetros da URL
        const isAdmin = urlParams.get('admin') === 'true'; // Verifica se o usuário é administrador
        
        document.getElementById('acoesHeader').style.display = isAdmin ? 'table-cell' : 'none'; // Exibe ou oculta a coluna de ações

        let clientes = JSON.parse(localStorage.getItem('clientes')) || []; // Obtém a lista de clientes do localStorage ou inicializa um array vazio

        function showMessage(type, text) {
            const messageElement = document.getElementById('message');
            messageElement.className = `message ${type}`;
            messageElement.innerText = text;
            messageElement.style.display = 'block';
            setTimeout(() => {
                messageElement.style.display = 'none';
            }, 3000);
        }

        // Função para exibir os clientes cadastrados
        function exibirClientes(filtrados = clientes) {
            const clientesList = document.getElementById('clientes'); // Obtém o elemento da tabela de clientes
            clientesList.innerHTML = ''; // Limpa o conteúdo da tabela
            filtrados.forEach((cliente, index) => { // Itera sobre cada cliente na lista
                const tr = document.createElement('tr'); // Cria uma nova linha na tabela
                tr.innerHTML = `
                    <td>${cliente.id}</td> <!-- Exibe o ID do cliente -->
                    <td>${cliente.nome}</td> <!-- Exibe o nome do cliente -->
                    <td>${cliente.telefone}</td> <!-- Exibe o telefone do cliente -->
                    <td>${cliente.cpf || ''}</td> <!-- Exibe o CPF do cliente -->
                    <td>${cliente.visitas}</td> <!-- Exibe o número de visitas do cliente -->
                    ${isAdmin ? `
                    <td>
                        <button class="edit-btn" onclick="editarCliente(${index})">Editar</button> <!-- Botão para editar o cliente -->
                        <button class="delete-btn" onclick="removerCliente(${index})">Remover</button> <!-- Botão para remover o cliente -->
                    </td>` : `<td style="display:none;"></td>`}
                `;
                clientesList.appendChild(tr); // Adiciona a linha à tabela
            });
        }

        // Função para remover um cliente
        function removerCliente(index) {
            if (confirm('Tem certeza que deseja remover este cliente?')) { // Exibe uma confirmação antes de remover o cliente
                clientes.splice(index, 1); // Remove o cliente da lista
                localStorage.setItem('clientes', JSON.stringify(clientes)); // Salva a lista atualizada no localStorage
                exibirClientes(); // Atualiza a exibição dos clientes
                showMessage('success', "Cliente removido com sucesso!");
            }
        }

        // Função para editar um cliente
        function editarCliente(index) {
            const cliente = clientes[index]; // Obtém os dados do cliente
            const nome = prompt("Editar Nome:", cliente.nome); // Solicita o novo nome
            const telefone = prompt("Editar Telefone:", cliente.telefone); // Solicita o novo telefone
            const cpf = prompt("Editar CPF (opcional):", cliente.cpf || ''); // Solicita o novo CPF

            if (nome && telefone.match(/^\(\d{2}\)\s\d{4,5}-\d{4}$/)) { // Verifica se o telefone está no formato correto
                if (cpf && !validarCPF(cpf)) {
                    showMessage('error', "CPF inválido.");
                    return;
                }

                if (cpf && clientes.some((c, i) => c.cpf === cpf && i !== index)) {
                    showMessage('error', "Este CPF já está cadastrado.");
                    return;
                }

                clientes[index] = { ...cliente, nome, telefone, cpf }; // Atualiza os dados do cliente
                localStorage.setItem('clientes', JSON.stringify(clientes)); // Salva a lista atualizada no localStorage
                exibirClientes(); // Atualiza a exibição dos clientes
                showMessage('success', "Cliente atualizado com sucesso!");
            } else {
                showMessage('error', "Por favor, insira dados válidos."); // Exibe uma mensagem de erro se os dados forem inválidos
            }
        }

        // Função para ordenar a tabela
        function ordenarTabela(coluna) {
            const ordem = document.querySelector(`th[onclick="ordenarTabela('${coluna}')"]`).getAttribute('data-ordem') || 'asc'; // Define a ordem de classificação
            clientes.sort((a, b) => {
                if (coluna === 'visitas') {
                    return ordem === 'asc' ? a[coluna] - b[coluna] : b[coluna] - a[coluna]; // Ordena numericamente
                } else {
                    return ordem === 'asc' ? a[coluna].localeCompare(b[coluna]) : b[coluna].localeCompare(a[coluna]); // Ordena alfabeticamente
                }
            });
            document.querySelector(`th[onclick="ordenarTabela('${coluna}')"]`).setAttribute('data-ordem', ordem === 'asc' ? 'desc' : 'asc'); // Alterna a ordem de classificação
            exibirClientes(); // Atualiza a exibição dos clientes
        }

        // Função para filtrar os clientes com base na barra de pesquisa
        function filtrarClientes() {
            const query = document.getElementById('barraPesquisa').value.toLowerCase(); // Obtém o valor da barra de pesquisa

            const filtrados = clientes.filter(cliente => {
                return (
                    cliente.nome.toLowerCase().includes(query) ||
                    cliente.cpf.includes(query) ||
                    cliente.telefone.includes(query) ||
                    cliente.id.toLowerCase().includes(query)
                );
            });

            exibirClientes(filtrados); // Atualiza a exibição dos clientes filtrados
        }

        // Adiciona evento de input para a barra de pesquisa
        document.getElementById('barraPesquisa').addEventListener('input', filtrarClientes);

        // Função para validar o CPF
        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]+/g, ''); // Remove caracteres não numéricos
            if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false; // Verifica se o CPF tem 11 dígitos e se não é uma sequência repetida
            let soma = 0;
            for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i); // Calcula a soma dos 9 primeiros dígitos
            let resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0; // Ajusta o resto se necessário
            if (resto !== parseInt(cpf.charAt(9))) return false; // Verifica o primeiro dígito verificador
            soma = 0;
            for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i); // Calcula a soma dos 10 primeiros dígitos
            resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0; // Ajusta o resto se necessário
            return resto === parseInt(cpf.charAt(10)); // Verifica o segundo dígito verificador
        }

        // Função para voltar para a página inicial
        function voltar() {
            window.location.href = "index.html";
        }

        // Atualiza a exibição dos clientes quando a página é carregada
        window.onload = exibirClientes;
    </script>
</body>
</html>
